<div class="container is-fluid"></div>
  <div class="columns is-gapless">
    
    <!-- Sidebar -->
    <div class="column is-2 sidebar bg-full-transparent has-text-white">
      <h2 class="title is-4 has-text-white has-text-centered">
        <i class="fas fa-tools"></i> Admin
      </h2>
      
      <div class="sidebar-menu">
        <ul>
          <li>
            <a href="#" class="tab-link is-active" data-tab="users-tab">
              <i class="fas fa-users"></i> Users Management
            </a>
          </li>
          <li>
            <a href="#" class="tab-link" data-tab="content-tab">
              <i class="fas fa-book"></i> Content Management
            </a>
          </li>
          <li>
            <a href="#" class="tab-link" data-tab="settings-tab">
              <i class="fas fa-cog"></i> Site Settings
            </a>
          </li>
          <li>
            <a href="#" class="tab-link" data-tab="reports-tab">
              <i class="fas fa-chart-bar"></i> Reports
            </a>
          </li>
          <li class="mt-6">
            <%= link_to destroy_user_session_path, method: :delete, class: "has-text-grey-light" do %>
              <i class="fas fa-sign-out-alt"></i> Logout
            <% end %>
          </li>
        </ul>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="column content-area">
      <div class="box bg-full-transparent has-text-white">
        <h1 class="title has-text-centered has-text-white">
          <i class="fas fa-tools"></i> Admin Dashboard
        </h1>
        
        <div class="notification bg-full-transparent">
          <h2 class="has-text-weight-bold"><i class="fas fa-user-shield"></i> Welcome, <%= current_user.username %>!</h2>
        </div>

        <% if flash[:alert] %>
          <div class="notification is-danger">
            <%= flash[:alert] %>
          </div>
        <% end %>

        <!-- Users Management Tab -->
        <div id="users-tab" class="tab-content is-active">
          <div class="box bg-full-transparent has-text-white">
            <h3 class="title is-5"><i class="fas fa-users"></i> Users Management</h3>
            
            <div class="field is-grouped mb-4">
              <div class="control">
                  <i class="fas fa-user-plus"></i> Add New User
              </div>
              <div class="control">
                <div class="select is-small">
                  <select id="role-filter">
                    <option value="">Filter by Role</option>
                    <option value="admin">Admin</option>
                    <option value="member">Member</option>
                    <option value="moderator">Moderator</option>
                  </select>
                </div>
              </div>
              <div class="control is-expanded">
                <input class="input is-small" type="text" placeholder="Search users..." id="user-search">
              </div>
            </div>
            
            <!-- Responsive Table Wrapper -->
            <div class="table-container">
              <table class="table is-fullwidth bg-full-transparent">
                <thead>
                  <tr>
                    <th><i class="fas fa-user"></i> Username</th>
                    <th><i class="fas fa-envelope"></i> Email</th>
                    <th><i class="fas fa-user-tag"></i> Role</th>
                    <th><i class="fas fa-calendar"></i> Joined</th>
                    <th><i class="fas fa-cogs"></i> Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @users.each do |user| %>
                    <tr>
                      <td><%= user.username %></td>
                      <td><%= user.email %></td>
                      <td><%= user.role.capitalize %></td>
                      <td><%= user.created_at.strftime("%b %d, %Y") %></td>
                      <td class="has-text-centered">
                        <div class="buttons is-flex">
                          <%= link_to admin_edit_user_path(user), class: "button is-small bg-transparent" do %>
                            <i class="fas fa-edit"></i>
                          <% end %>

                          <% if user != current_user %>
                            <%= button_to admin_delete_user_path(user), method: :delete, 
                                data: { turbo: false, confirm: 'Are you sure you want to delete this user?' }, 
                                class: "button is-small is-danger is-outlined", 
                                form: { style: 'display: inline-block;' } do %>
                              <i class="fas fa-trash"></i>
                            <% end %>
                          <% else %>
                            <span class="tag is-info is-light">Current</span>
                          <% end %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
            
          </div>
        </div>

        <!-- Content Management Tab -->
        <div id="content-tab" class="tab-content">
          <div class="box bg-full-transparent has-text-white">
            <h3 class="title is-5"><i class="fas fa-book"></i> Content Management</h3>
            
            <div class="tabs is-boxed mb-4">
              <ul>
                <li class="is-active"><a href="#manga-section">Manga</a></li>
                <li><a href="#chapter-section">Chapters</a></li>
                <li><a href="#genre-section">Genres</a></li>
              </ul>
            </div>
            
            <div id="manga-section">
              <div class="field is-grouped mb-4">
                <div class="control">
                  <%= link_to new_manga_path, class: "button is-primary is-small" do %>
                    <i class="fas fa-plus"></i> Add New Manga
                  <% end %>
                </div>
                <div class="control is-expanded">
                  <input class="input is-small" type="text" placeholder="Search manga...">
                </div>
              </div>
              
              <div class="table-container">
                <table class="table is-fullwidth bg-full-transparent">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Chapters</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if @mangas&.any? %>
                      <% @mangas.each do |manga| %>
                        <tr>
                          <td><%= manga.title %></td>
                          <td><%= manga.chapters_count || 0 %></td>
                          <td><%= manga.status %></td>
                          <td>
                            <div class="buttons is-flex">
                              <%= link_to edit_manga_path(manga), class: "button is-small bg-transparent" do %>
                                <i class="fas fa-edit"></i>
                              <% end %>
                              <%= link_to manga_path(manga), class: "button is-small bg-transparent" do %>
                                <i class="fas fa-eye"></i>
                              <% end %>
                            </div>
                          </td>
                        </tr>
                      <% end %>
                    <% else %>
                      <tr>
                        <td colspan="4" class="has-text-centered">No manga found</td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
          <div class="box bg-full-transparent has-text-white">
            <h3 class="title is-5"><i class="fas fa-cog"></i> Site Settings</h3>
            
            <form action="/admin/settings" method="post">
              <div class="field">
                <label class="label has-text-white">Site Name</label>
                <div class="control">
                  <input class="input" type="text" value="MangaReader" name="site_name">
                </div>
              </div>
              
              <div class="field">
                <label class="label has-text-white">Site Description</label>
                <div class="control">
                  <textarea class="textarea" name="site_description">Your favorite manga reading platform</textarea>
                </div>
              </div>
              
              <div class="field">
                <label class="label has-text-white">Maintenance Mode</label>
                <div class="control">
                  <label class="radio">
                    <input type="radio" name="maintenance_mode" value="0" checked>
                    Off
                  </label>
                  <label class="radio">
                    <input type="radio" name="maintenance_mode" value="1">
                    On
                  </label>
                </div>
              </div>
              
              <div class="field is-grouped mt-5">
                <div class="control">
                  <button class="button is-primary">Save Changes</button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content">
          <div class="box bg-full-transparent has-text-white">
            <h3 class="title is-5"><i class="fas fa-chart-bar"></i> Reports</h3>
            
            <div class="columns is-multiline">
              <div class="column is-6">
                <div class="box bg-transparent has-text-white">
                  <h4 class="is-size-6 mb-2">User Registrations</h4>
                  <p class="is-size-3 has-text-weight-bold">
                    <%= @user_count || 0 %>
                  </p>
                  <p class="is-size-7 has-text-grey-light">
                    <i class="fas fa-arrow-up has-text-success"></i> 12% from last month
                  </p>
                </div>
              </div>
              
              <div class="column is-6">
                <div class="box bg-transparent has-text-white">
                  <h4 class="is-size-6 mb-2">Total Manga Views</h4>
                  <p class="is-size-3 has-text-weight-bold">
                    <%= @total_views || 0 %>
                  </p>
                  <p class="is-size-7 has-text-grey-light">
                    <i class="fas fa-arrow-up has-text-success"></i> 8% from last month
                  </p>
                </div>
              </div>
              
              <div class="column is-6">
                <div class="box bg-transparent has-text-white">
                  <h4 class="is-size-6 mb-2">Total Manga Titles</h4>
                  <p class="is-size-3 has-text-weight-bold">
                    <%= @manga_count || 0 %>
                  </p>
                </div>
              </div>
              
              <div class="column is-6">
                <div class="box bg-transparent has-text-white">
                  <h4 class="is-size-6 mb-2">Total Chapters</h4>
                  <p class="is-size-3 has-text-weight-bold">
                    <%= @chapter_count || 0 %>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching functionality
    const tabLinks = document.querySelectorAll('.tab-link');
    
    // Function to set active tab
    function setActiveTab(tabId) {
      // Remove active class from all tabs and links
      document.querySelectorAll('.tab-content').forEach(function(tab) {
        tab.classList.remove('is-active');
      });
      
      document.querySelectorAll('.tab-link').forEach(function(tabLink) {
        tabLink.classList.remove('is-active');
      });
      
      // Add active class to selected tab and link
      document.getElementById(tabId).classList.add('is-active');
      document.querySelector(`.tab-link[data-tab="${tabId}"]`).classList.add('is-active');
      
      // Store active tab in session storage
      sessionStorage.setItem('adminActiveTab', tabId);
    }
    
    // Handle tab link clicks
    tabLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const tabId = this.getAttribute('data-tab');
        setActiveTab(tabId);
      });
    });
    
    // Content management sub-tabs
    const contentTabs = document.querySelectorAll('.tabs.is-boxed li a');
    contentTabs.forEach(function(tab) {
      tab.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active class from all tabs
        document.querySelectorAll('.tabs.is-boxed li').forEach(function(t) {
          t.classList.remove('is-active');
        });
        
        // Hide all section contents
        document.querySelectorAll('#manga-section, #chapter-section, #genre-section').forEach(function(section) {
          section.style.display = 'none';
        });
        
        // Set active tab and show content
        this.parentElement.classList.add('is-active');
        const sectionId = this.getAttribute('href');
        document.querySelector(sectionId).style.display = 'block';
      });
    });
    
    // Restore active tab from session storage if available
    const savedTab = sessionStorage.getItem('adminActiveTab');
    if (savedTab) {
      setActiveTab(savedTab);
    } else {
      // Default to users tab if no saved state
      setActiveTab('users-tab');
    }
    
    // Initialize content management tabs (show only manga section initially)
    document.querySelectorAll('#chapter-section, #genre-section').forEach(function(section) {
      section.style.display = 'none';
    });
    
    // User search functionality
    const userSearch = document.getElementById('user-search');
    if (userSearch) {
      userSearch.addEventListener('keyup', function() {
        const searchText = this.value.toLowerCase();
        const userRows = document.querySelectorAll('#users-tab tbody tr');
        
        userRows.forEach(function(row) {
          const username = row.cells[0].textContent.toLowerCase();
          const email = row.cells[1].textContent.toLowerCase();
          
          if (username.includes(searchText) || email.includes(searchText)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    }
    
    // Role filter functionality
    const roleFilter = document.getElementById('role-filter');
    if (roleFilter) {
      roleFilter.addEventListener('change', function() {
        const selectedRole = this.value.toLowerCase();
        const userRows = document.querySelectorAll('#users-tab tbody tr');
        
        userRows.forEach(function(row) {
          const role = row.cells[2].textContent.toLowerCase();
          
          if (selectedRole === '' || role === selectedRole) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    }
  });
</script>

 <style>
    .sidebar {
      min-height: 100vh;
      padding: 1rem;
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }
    .sidebar-menu {
      margin-top: 2rem;
    }
    .sidebar-menu li {
      margin-bottom: 1rem;
    }
    .sidebar-menu a {
      color: white;
      display: block;
      padding: 0.75rem;
      border-radius: 4px;
    }
    .sidebar-menu a:hover, .sidebar-menu a.is-active {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .sidebar-menu i {
      margin-right: 0.5rem;
    }
    .content-area {
      padding: 1rem;
    }
    .bookmark-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }
    .bookmark-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .bookmark-image {
      flex: 0 0 70px;
      margin-right: 1rem;
    }
    .bookmark-info {
      flex: 1;
    }
    .manga-thumbnail {
      width: 70px;
      height: 100px;
      object-fit: cover;
      border-radius: 4px;
    }
    .pagination-wrapper {
      margin-top: 1.5rem;
    }
    .pagination-link, .pagination-ellipsis {
      background-color: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      color: white;
    }
    .pagination-link.is-current {
      background-color: rgba(72, 95, 199, 0.7);
      border-color: rgba(72, 95, 199, 0.8);
    }
    .pagination-link:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .tab-content {
      display: none;
    }
    .tab-content.is-active {
      display: block;
    }
  </style>
